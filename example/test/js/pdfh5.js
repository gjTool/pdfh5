!function(t,e){"undefined"!=typeof require&&(t.$=require("./jquery-1.11.3.min.js"),t.pdfjsWorker=require("./pdf.worker.js"),t.pdfjsLib=require("./pdf.js"));var i=t.pdfjsLib,n=t.$,a=t.pdfjsWorker;"function"==typeof define&&define.amd?define(function(){return e(t,a,i,n)}):"undefined"!=typeof module&&module.exports?module.exports=e(t,a,i,n):t.Pdfh5=e(t,a,i,n)}("undefined"!=typeof window?window:this,function(t,e,i,n){"use strict";var a=function(e){var i=function(t,i,n){this.el=e(t),this.viewerContainer=n,this.zoomFactor=1,this.lastScale=1,this.offset={x:0,y:0},this.options=e.extend({},this.defaults,i),this.setupMarkup(),this.bindEvents(),this.update(),this.enable(),this.height=0,this.load=!1,this.direction=null,this.clientY=null,this.lastclientY=null},n=function(t,e){return t+e},a=function(t,e){return t>e-.01&&t<e+.01};i.prototype={defaults:{tapZoomFactor:2,zoomOutFactor:1.2,animationDuration:300,maxZoom:4,minZoom:.8,lockDragAxis:!1,use2d:!0,zoomStartEventName:"pz_zoomstart",zoomEndEventName:"pz_zoomend",dragStartEventName:"pz_dragstart",dragEndEventName:"pz_dragend",doubleTapEventName:"pz_doubletap"},handleDragStart:function(t){this.el.trigger(this.options.dragStartEventName),this.stopAnimation(),this.lastDragPosition=!1,this.hasInteraction=!0,this.handleDrag(t)},handleDrag:function(t){if(this.zoomFactor>1){var e=this.getTouches(t)[0];this.drag(e,this.lastDragPosition,t),this.offset=this.sanitizeOffset(this.offset),this.lastDragPosition=e}},handleDragEnd:function(){this.el.trigger(this.options.dragEndEventName),this.end()},handleZoomStart:function(t){this.el.trigger(this.options.zoomStartEventName),this.stopAnimation(),this.lastScale=1,this.nthZoom=0,this.lastZoomCenter=!1,this.hasInteraction=!0},handleZoom:function(t,e){var i=this.getTouchCenter(this.getTouches(t)),n=e/this.lastScale;this.lastScale=e,this.nthZoom+=1,this.nthZoom>3&&(this.scale(n,i),this.drag(i,this.lastZoomCenter)),this.lastZoomCenter=i},handleZoomEnd:function(){this.el.trigger(this.options.zoomEndEventName),this.end()},handleDoubleTap:function(t){var e=this.getTouches(t)[0],i=this.zoomFactor>1?1:this.options.tapZoomFactor,n=this.zoomFactor,a=function(t){this.scaleTo(n+t*(i-n),e)}.bind(this);this.hasInteraction||(n>i&&(e=this.getCurrentZoomCenter()),this.animate(this.options.animationDuration,a,this.swing),this.el.trigger(this.options.doubleTapEventName))},sanitizeOffset:function(t){var e=(this.zoomFactor-1)*this.getContainerX(),i=(this.zoomFactor-1)*this.getContainerY(),n=Math.max(e,0),a=Math.max(i,0),o=Math.min(e,0),s=Math.min(i,0),r=Math.min(Math.max(t.x,o),n),h=Math.min(Math.max(t.y,s),a);return{x:r,y:h}},scaleTo:function(t,e){this.scale(t/this.zoomFactor,e)},scale:function(t,e){t=this.scaleZoomFactor(t),this.addOffset({x:(t-1)*(e.x+this.offset.x),y:(t-1)*(e.y+this.offset.y)})},scaleZoomFactor:function(t){var e=this.zoomFactor;return this.zoomFactor*=t,this.zoomFactor=Math.min(this.options.maxZoom,Math.max(this.zoomFactor,this.options.minZoom)),this.zoomFactor/e},drag:function(t,e,i){e&&(this.options.lockDragAxis?Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?this.addOffset({x:-(t.x-e.x),y:0}):this.addOffset({y:-(t.y-e.y),x:0}):(t.y-e.y<0?this.direction="down":t.y-e.y>10&&(this.direction="up"),this.addOffset({y:-(t.y-e.y),x:-(t.x-e.x)})))},getTouchCenter:function(t){return this.getVectorAvg(t)},getVectorAvg:function(t){return{x:t.map(function(t){return t.x}).reduce(n)/t.length,y:t.map(function(t){return t.y}).reduce(n)/t.length}},addOffset:function(t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y}},sanitize:function(){this.zoomFactor<this.options.zoomOutFactor?this.zoomOutAnimation():this.isInsaneOffset(this.offset)&&this.sanitizeOffsetAnimation()},isInsaneOffset:function(t){var e=this.sanitizeOffset(t);return e.x!==t.x||e.y!==t.y},sanitizeOffsetAnimation:function(){var t=this.sanitizeOffset(this.offset),e={x:this.offset.x,y:this.offset.y},i=function(i){this.offset.x=e.x+i*(t.x-e.x),this.offset.y=e.y+i*(t.y-e.y),this.update()}.bind(this);this.animate(this.options.animationDuration,i,this.swing)},zoomOutAnimation:function(){var t=this.zoomFactor,e=1,i=this.getCurrentZoomCenter(),n=function(n){this.scaleTo(t+n*(e-t),i)}.bind(this);this.animate(this.options.animationDuration,n,this.swing)},updateAspectRatio:function(){this.setContainerY(this.getContainerX()/this.getAspectRatio())},getInitialZoomFactor:function(){return this.container[0]&&this.el[0]?this.container[0].offsetWidth/this.el[0].offsetWidth:0},getAspectRatio:function(){if(this.el[0]){var t=this.el[0].offsetHeight;return this.container[0].offsetWidth/t}return 0},getCurrentZoomCenter:function(){var t=this.container[0].offsetWidth*this.zoomFactor,e=this.offset.x,i=t-e-this.container[0].offsetWidth,n=e/i,a=n*this.container[0].offsetWidth/(n+1),o=this.container[0].offsetHeight*this.zoomFactor,s=this.offset.y,r=o-s-this.container[0].offsetHeight,h=s/r,c=h*this.container[0].offsetHeight/(h+1);return 0===i&&(a=this.container[0].offsetWidth),0===r&&(c=this.container[0].offsetHeight),{x:a,y:c}},canDrag:function(){return!a(this.zoomFactor,1)},getTouches:function(t){var e=this.container.offset();return Array.prototype.slice.call(t.touches).map(function(t){return{x:t.pageX-e.left,y:t.pageY-e.top}})},animate:function(t,e,i,n){var a=(new Date).getTime(),o=function(){if(this.inAnimation){var s=(new Date).getTime()-a,r=s/t;s>=t?(e(1),n&&n(),this.update(),this.stopAnimation(),this.update()):(i&&(r=i(r)),e(r),this.update(),requestAnimationFrame(o))}}.bind(this);this.inAnimation=!0,requestAnimationFrame(o)},stopAnimation:function(){this.inAnimation=!1},swing:function(t){return-Math.cos(t*Math.PI)/2+.5},getContainerX:function(){return this.el[0]?this.el[0].offsetWidth:0},getContainerY:function(){return this.el[0].offsetHeight},setContainerY:function(t){return t=t.toFixed(2),this.container.height(t)},setupMarkup:function(){this.container=e('<div class="pinch-zoom-container"></div>'),this.el.before(this.container),this.container.append(this.el),this.container.css({position:"relative"}),this.el.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%",position:"relative"})},end:function(){this.hasInteraction=!1,this.sanitize(),this.update()},bindEvents:function(){o(this.container.eq(0),this,this.viewerContainer),e(t).on("resize",this.update.bind(this)),e(this.el).find("img").on("load",this.update.bind(this))},update:function(){this.updatePlaned||(this.updatePlaned=!0,setTimeout(function(){this.updatePlaned=!1,this.updateAspectRatio();var t=this.getInitialZoomFactor()*this.zoomFactor,e=(-this.offset.x/t).toFixed(3),i=(-this.offset.y/t).toFixed(3);this.lastclientY=i;var n="scale3d("+t+", "+t+",1) translate3d("+e+"px,"+i+"px,0px)",a="scale("+t+", "+t+") translate("+e+"px,"+i+"px)";(function(){this.clone&&(this.clone.remove(),delete this.clone)}).bind(this);!this.options.use2d||this.hasInteraction||this.inAnimation?(this.is3d=!0,this.el.css({"-webkit-transform":n,"-o-transform":a,"-ms-transform":a,"-moz-transform":a,transform:n})):(this.is3d,this.el.css({"-webkit-transform":a,"-o-transform":a,"-ms-transform":a,"-moz-transform":a,transform:a}),this.is3d=!1),this.done&&this.done.call(this,t)}.bind(this),0))},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},destroy:function(){var t=this.el.clone(),e=this.container.parent();this.container.remove(),t.removeAttr("style"),e.append(t)}};var o=function(t,e,i){var n=null,a=0,o=null,s=null,r=null,h=null,c=0,l=0,d=function(t,i){if(n!==t){if(n&&!t)switch(n){case"zoom":e.handleZoomEnd(i);break;case"drag":e.handleDragEnd(i)}switch(t){case"zoom":e.handleZoomStart(i);break;case"drag":e.handleDragStart(i)}}n=t},f=function(t){2===a?d("zoom"):1===a&&e.canDrag()?d("drag",t):d(null,t)},u=function(t){return Array.prototype.slice.call(t).map(function(t){return{x:t.pageX,y:t.pageY}})},m=function(t,e){var i,n;return i=t.x-e.x,n=t.y-e.y,Math.sqrt(i*i+n*n)},p=function(t,e){var i=m(t[0],t[1]),n=m(e[0],e[1]);return n/i},g=function(t){t.stopPropagation(),t.preventDefault()},v=function(t){var i=(new Date).getTime(),s=t.changedTouches[0].pageY,h=w.scrollTop||0;if(a>1&&(o=null,r=null,g(t)),i-o<300&&Math.abs(s-r)<10&&Math.abs(l-h)<10)switch(g(t),e.handleDoubleTap(t),n){case"zoom":e.handleZoomEnd(t);break;case"drag":e.handleDragEnd(t)}1===a&&(o=i,r=s,l=h)},y=!0;if(i)var w=i[0];w&&(w.addEventListener("touchstart",function(t){e.enabled&&(y=!0,a=t.touches.length,v(t),h=t.changedTouches[0].clientY,a>1&&g(t))}),w.addEventListener("touchmove",function(t){if(e.enabled){if(c=t.changedTouches[0].clientY,y)f(t),s=u(t.touches);else{switch(n){case"zoom":e.handleZoom(t,p(s,u(t.touches)));break;case"drag":e.handleDrag(t)}n&&e.update(c)}a>1&&g(t),y=!1}}),w.addEventListener("touchend",function(t){e.enabled&&(a=t.touches.length,a>1&&g(t),f(t))}))};return i},o=a(n),s=function(t,e){this.container=n(t),this.thePDF=null,this.totalNum=null,this.pages=null,this.initTime=0,this.scale=1.3,this.currentNum=1,this.loadedCount=0,this.endTime=0,this.pinchZoom=null,this.timer=null,this.docWidth=document.documentElement.clientWidth,this.eventType={},this.cache={},this.cacheNum=1,this.init(e)};return s.prototype={init:function(e){function a(e){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=t.location.search.substr(1).match(i);return null!=n?decodeURIComponent(n[2]):""}this.container.addClass("pdfjs");var o=this;i.cMapUrl="./cmaps/",i.cMapPacked=!0,this.initTime=(new Date).getTime(),setTimeout(function(){var t=o.eventType.scroll;if(t&&t instanceof Array)for(var e=0;e<t.length;e++)t[e]&&t[e].call(o,o.initTime)},0),e=e?e:{},e.pdfurl=e.pdfurl?e.pdfurl:null,e.data=e.data?e.data:null,e.scale=e.scale?e.scale:o.scale,e.zoomEnable=e.zoomEnable!==!1,e.scrollEnable=e.scrollEnable!==!1,e.loadingBar=e.loadingBar!==!1,e.pageNum=e.pageNum!==!1,e.backTop=e.backTop!==!1,e.URIenable=e.URIenable!==!1,e.fullscreen=e.fullscreen!==!1,e.lazy=e.lazy===!0;var s='<div class="loadingBar"><div class="progress"> <div class="glimmer"></div> </div></div><div class="pageNum"><div class="pageNum-bg"></div> <div class="pageNum-num"> <span class="pageNow">1</span>/<span class="pageTotal">1</span></div> </div><div class="backTop"></div>';this.container.find(".pageNum")[0]||this.container.append(s);var r=document.createElement("div");r.className="pdfViewer";var h=document.createElement("div");h.className="viewerContainer",h.appendChild(r),this.container.append(h),this.viewer=n(r),this.viewerContainer=n(h),this.pageNum=this.container.find(".pageNum"),this.pageNow=this.pageNum.find(".pageNow"),this.pageTotal=this.pageNum.find(".pageTotal"),this.loadingBar=this.container.find(".loadingBar"),this.progress=this.loadingBar.find(".progress"),this.backTop=this.container.find(".backTop"),e.loadingBar||this.loadingBar.hide();var c=this.container.height(),l=c*(1/3);e.scrollEnable?this.viewerContainer.css({overflow:"auto"}):this.viewerContainer.css({overflow:"hidden"}),h.addEventListener("scroll",function(){var t=h.scrollTop;t>=150?e.backTop&&o.backTop.show():e.backTop&&o.backTop.fadeOut(200),o.viewerContainer&&(o.pages=o.viewerContainer.find(".pageContainer")),clearTimeout(o.timer),e.pageNum&&o.pageNum.show();var i=c;if(o.pages&&o.pages.each(function(t,n){var a=n.getBoundingClientRect().top,s=n.getBoundingClientRect().bottom;a<=l&&s>l&&(e.pageNum&&o.pageNow.text(t+1),o.currentNum=t+1),a<=i&&s>i&&(o.cacheNum=t+1)}),o.timer=setTimeout(function(){e.pageNum&&o.pageNum.fadeOut(200)},1500),e.lazy){var n=Math.floor(100/o.totalNum).toFixed(2);if(!o.cache[o.cacheNum+""].loaded){var a=o.cache[o.cacheNum+""].page,s=o.cache[o.cacheNum+""].container,r=o.cacheNum;o.cache[r+""].loaded=!0;var d=o.cache[r+""].scaledViewport;o.renderSvg(a,d,r,n,s,e)}if(o.cache[o.totalNum-1+""].loaded&&!o.cache[o.totalNum+""].loaded){var a=o.cache[o.totalNum+""].page,s=o.cache[o.totalNum+""].container,r=o.totalNum;o.cache[r+""].loaded=!0;var d=o.cache[r+""].scaledViewport;o.renderSvg(a,d,r,n,s,e)}}var f=o.eventType.scroll;if(f&&f instanceof Array)for(var u=0;u<f.length;u++)f[u]&&f[u].call(o,t)}),this.backTop.on("click tap",function(){var t=o.viewer.css("transform"),e=t.replace(/[a-z\(\)\s]/g,"").split(","),i=e[0],n=e[3],a=e[4]/2,s=o.viewer[0].getBoundingClientRect().left;s<=2*-o.docWidth&&(a=-o.docWidth/2),o.viewer.css({transform:"scale("+i+", "+n+") translate("+a+"px, 0px)"}),o.pinchZoom&&(o.pinchZoom.offset.y=0,o.pinchZoom.lastclientY=0),o.viewerContainer.animate({scrollTop:0},300);var r=o.eventType.backTop;if(r&&r instanceof Array)for(var h=0;h<r.length;h++)r[h]&&r[h].call(o)});var d=a("file");if(d&&e.URIenable)o.renderPdf(e,{url:d});else if(e.pdfurl)o.renderPdf(e,{url:e.pdfurl});else{if(!e.data){var f=(new Date).getTime();o.endTime=f-o.initTime;var u=o.eventType.complete;if(u&&u instanceof Array)for(var m=0;m<u.length;m++)u[m]&&u[m].call(o,"error","Expect options.pdfurl or options.data!",o.endTime);var p=o.eventType.error;if(p&&p instanceof Array)for(var m=0;m<p.length;m++)p[m]&&p[m].call(o,"Expect options.pdfurl or options.data!",o.endTime);throw Error("Expect options.pdfurl or options.data!")}o.renderPdf(e,{data:e.data})}},renderPdf:function(t,e){var n=this;i.getDocument(e).then(function(e){n.thePDF=e,n.totalNum=e.numPages,n.pageTotal.text(n.totalNum);var i=n.eventType.ready;if(i&&i instanceof Array)for(var a=0;a<i.length;a++)i[a]&&i[a].call(n);var o=Promise.resolve(),s=Math.floor(100/n.totalNum).toFixed(2);n.progress.css({width:"1%"});for(var a=1;a<=n.totalNum;a++)n.cache[a+""]={page:null,loaded:!1,container:null,scaledViewport:null},o=o.then(function(e){return n.thePDF.getPage(e).then(function(i){n.cache[e+""].page=i;var a=i.getViewport(t.scale),o=(n.docWidth/a.width).toFixed(2),r=i.getViewport(o),h=document.createElement("div");h.id="pageContainer"+e,h.className="pageContainer",h.setAttribute("name","page="+e),h.setAttribute("title","Page "+e),t.fullscreen===!1&&a.width<n.docWidth&&(r=a,h.style.width=r.width+"px");var c=document.createElement("div");c.className="loadEffect",h.appendChild(c),h.style.height=r.height+"px",n.viewer[0].appendChild(h),n.cache[e+""].container=h,n.cache[e+""].scaledViewport=r;var l=0,d=n.container.height();if(n.pages=n.viewerContainer.find(".pageContainer"),n.pages&&t.lazy&&n.pages.each(function(t,e){var i=e.offsetTop;i<=d&&(l=t+1,n.cache[l+""].loaded=!0)}),!(e>l&&t.lazy))return n.renderSvg(i,r,e,s,h,t)})}.bind(null,a))}).catch(function(t){var e=(new Date).getTime();n.endTime=e-n.initTime;var i=n.eventType.complete;if(i&&i instanceof Array)for(var a=0;a<i.length;a++)i[a]&&i[a].call(n,"error",t.message,n.endTime);var o=n.eventType.error;if(o&&o instanceof Array)for(var a=0;a<o.length;a++)o[a]&&o[a].call(n,t.message,n.endTime)})},finalRender:function(t){var e=(new Date).getTime(),i=this;i.progress.css({width:"100%"}),i.loadingBar.hide(),i.endTime=e-i.initTime,1!==i.totalNum?i.cache[i.totalNum-1+""].loaded=!0:i.cache[1].loaded=!0,t.zoomEnable&&(i.pinchZoom=new o(i.viewer,{},i.viewerContainer),i.pinchZoom.done=function(t){1==t?i.viewerContainer&&i.viewerContainer.css({"-webkit-overflow-scrolling":"touch"}):i.viewerContainer&&i.viewerContainer.css({"-webkit-overflow-scrolling":"auto"});var e=i.eventType.zoom;if(e&&e instanceof Array)for(var n=0;n<e.length;n++)e[n]&&e[n].call(i,t)});var n=i.eventType.complete;if(n&&n instanceof Array)for(var a=0;a<n.length;a++)n[a]&&n[a].call(i,"success","pdf加载完成",i.endTime);var s=i.eventType.success;if(s&&s instanceof Array)for(var a=0;a<s.length;a++)s[a]&&s[a].call(i,i.endTime)},renderSvg:function(t,e,n,a,o,s){var r=this;return t.getOperatorList().then(function(h){var c=new i.SVGGraphics(t.commonObjs,t.objs);return c.getSVG(h,e).then(function(t){r.loadedCount++,o.children[0].style.display="none",o.appendChild(t),t.style.width="100%",r.progress.css({width:a*r.loadedCount+"%"});var e=(new Date).getTime(),i=r.eventType.render;if(i&&i instanceof Array)for(var h=0;h<i.length;h++)i[h]&&i[h].call(r,n,e-r.initTime,o);r.loadedCount===r.totalNum&&r.finalRender(s)})})},show:function(t){this.container.show(),t&&t.call(this);var e=this.eventType.show;if(e&&e instanceof Array)for(var i=0;i<e.length;i++)e[i]&&e[i].call(this)},hide:function(t){this.container.hide(),t&&t.call(this);var e=this.eventType.hide;if(e&&e instanceof Array)for(var i=0;i<e.length;i++)e[i]&&e[i].call(this)},on:function(t,e){this.eventType[t]&&this.eventType[t]instanceof Array&&this.eventType[t].push(e),this.eventType[t]=[e]},scrollEnable:function(t){t===!1?this.viewerContainer.css({overflow:"hidden"}):this.viewerContainer.css({overflow:"auto"});var e=this.eventType.scrollEnable;if(e&&e instanceof Array)for(var i=0;i<e.length;i++)e[i]&&e[i].call(this,t)},zoomEnable:function(t){t===!1?this.pinchZoom.disable():this.pinchZoom.enable();var e=this.eventType.zoomEnable;if(e&&e instanceof Array)for(var i=0;i<e.length;i++)e[i]&&e[i].call(this,t)},reset:function(t){this.pinchZoom&&(this.pinchZoom.offset.y=0,this.pinchZoom.offset.x=0,this.pinchZoom.lastclientY=0,this.pinchZoom.zoomFactor=1,this.pinchZoom.update()),this.viewerContainer&&this.viewerContainer.scrollTop(0),t&&t.call(this);var e=this.eventType.reset;if(e&&e instanceof Array)for(var i=0;i<e.length;i++)e[i]&&e[i].call(this,flag)},destroy:function(t){this.reset(),this.thePDF&&(this.thePDF.destroy(),this.thePDF=null),this.viewerContainer&&(this.viewerContainer.remove(),this.viewerContainer=null),this.container&&(this.container.html(""),this.container=null),this.totalNum=null,this.pages=null,this.initTime=0,this.endTime=0,this.viewer=null,this.pageNum=null,this.pageNow=null,this.pageTotal=null,this.loadingBar=null,this.progress=null,this.loadedCount=0,this.timer=null,this.show=null,this.hide=null,t&&t.call(this);var e=this.eventType.destroy;if(e&&e instanceof Array)for(var i=0;i<e.length;i++)e[i]&&e[i].call(this,flag)}},s});